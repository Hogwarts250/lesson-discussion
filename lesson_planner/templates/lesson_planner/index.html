{% extends "transactions/base.html" %} {% load bootstrap4 %}

{% block content %}
<a href="{% url 'transactions:index' %}">index</a>
<br>
<a href="{% url 'lesson_planner:create_lesson' %}">create_lesson</a>
{% for lesson in lessons %}
<div class="card">
  <p>{{ lesson.name }}</p>

  <p>teacher: {{ lesson.teacher }}</p>
  <p>students: </p>
  <ul>
    {% for student_status in lesson.studentstatus_set.all %}
    <li>
      <!-- TODO: Add confirm and deny buttons (similar to transaction) -->
      <p>{{ student_status.student.username }} 
        {% if student_status.status == "pending" and student_status.student == user %}
        <form action="{% url 'lesson_planner:index' student_status.id %}" method="POST">
          {% csrf_token %}
          <input class="btn" type="submit" name="confirm_lesson" value="Confirm">
          <input class="btn" type="submit" name="deny_lesson" value="Deny">
        </form>
        {% else %}
        <small>{{ student_status.status }}</small>
        {% endif %}
      </p>
    </li>
    {% endfor %}
  </ul>

  <p>date and time: {{ lesson.lesson_datetime }}</p>

  {% if lesson.amount %}
  <p>amount: ${{ lesson.amount }} / student</p>

  <div class="container">
    {% for transaction in lesson.transaction_set.all %}
    <div class="card">
      <p>student: {{ transaction.buyer }} </p>
      {% if transaction.status == "pending" %}
        {% if user == transaction.buyer %}
        <form action="{% url 'lesson_planner:index' transaction.id %}" method="POST">
          {% csrf_token %}
          <input class="btn" type="submit" name="confirm_transaction" value="Confirm">
          <input class="btn" type="submit" name="deny_transaction" value="Deny">
        </form>
        {% else %}
        <p>waiting for confirmation...</p>
        {% endif %}
      {% elif transaction.status == "confirmed" %}
      <p>confirmed.</p>
      {% else %}
      <p>denied.</p>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <p>repeat: {{ lesson.repeat }}</p>
  {% if lesson.repeat != lesson.RepeatChoices.NEVER %}
  <p>start date: {{ lesson.start_date}}</p>
  <p>end date: {{ lesson.end_date }}</p>
  {% endif %}
</div>
{% endfor %}
{% endblock content %}